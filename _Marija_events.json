{"paragraphs":[{"title":"Ucitavanje biblioteka","text":"%spark2.pyspark\n\nfrom pyspark.sql.types import IntegerType, TimestampType, DecimalType, DoubleType, FloatType\nfrom pyspark.sql import functions as F\nfrom pyspark.sql.window import Window\nfrom pyspark.ml.feature import Bucketizer\nfrom pyspark.ml.evaluation import RegressionEvaluator\nfrom pyspark.ml.evaluation import MulticlassClassificationEvaluator\nfrom pyspark.ml.recommendation import ALS\nfrom pyspark.ml.tuning import TrainValidationSplit, ParamGridBuilder, CrossValidator\nfrom pyspark.mllib.evaluation import RegressionMetrics, RankingMetrics\nfrom functools import reduce","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632613_1487268327","id":"20180809-102707_410500063","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:667"},{"title":"Ucitavanje dataset-a events","text":"%spark2.pyspark\n\nevents   = spark.read.csv('events_v1.csv',sep=',',inferSchema=True, header=True)\nevents = events.drop(\"_c0\")","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632614_1488422573","id":"20180809-102726_24620851","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:668"},{"title":"Broj opservacija u dataset-u","text":"%spark2.pyspark\nevents.count()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1746784\n"}]},"apps":[],"jobName":"paragraph_1548166632614_1488422573","id":"20180901-122240_506239648","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:669"},{"title":"Broj jedinstvenih proizvoda grupisanih po korisnicima","text":"%spark2.pyspark\n\ndf = events.groupBy(\"visitorid\").agg(F.countDistinct(\"itemid\"))\n#df.show()\n","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632614_1488422573","id":"20180901-111129_1829385880","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:670"},{"title":"Preimenovanje kolona","text":"%spark2.pyspark\ndf = df.withColumnRenamed('count(DISTINCT itemid)', 'num_of_items').withColumnRenamed('visitorid', 'visitorid_df')","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632614_1488422573","id":"20180901-122525_2069624944","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:671"},{"title":"Izbacivanje korisnika koji nisu imali interakciju sa vise od 3 proizvoda","text":"%spark2.pyspark\ndf = df.filter('num_of_items > 2')","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632614_1488422573","id":"20180901-122733_1482328304","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:672"},{"title":"Join izmedju tabela events i df","text":"%spark2.pyspark\nevents = events.join(df, events['visitorid']==df['visitorid_df'], 'inner')","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632614_1488422573","id":"20180901-112853_625863054","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:673"},{"title":"Izbacivanje nepotrebne kolone","text":"%spark2.pyspark\nevents = events.drop(\"visitorid_df\")","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632614_1488422573","id":"20180901-122858_239144119","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:674"},{"title":"Broj opservacija u dataset-u","text":"%spark2.pyspark\nevents.count()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1004662\n"}]},"apps":[],"jobName":"paragraph_1548166632614_1488422573","id":"20180809-111643_2074479621","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:675"},{"title":"Prikaz events dataset-a","text":"%spark2.pyspark\nevents.show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+---------+-----------+------+-------------+---+------------+\n|           timestamp|visitorid|      event|itemid|transactionid|cnt|num_of_items|\n+--------------------+---------+-----------+------+-------------+---+------------+\n|2015-08-17 06:37:...|     2866|       view| 90950|         null|  1|           3|\n|2015-09-03 05:21:...|     2866|       view|294615|         null|  1|           3|\n|2015-07-25 20:18:...|     2866|       view| 83908|         null|  2|           3|\n|2015-07-25 20:30:...|     2866|       view| 83908|         null|  2|           3|\n|2015-05-21 00:26:...|     4101|       view|104752|         null|  4|          14|\n|2015-05-21 00:25:...|     4101|       view|115244|         null|  2|          14|\n|2015-05-21 00:11:...|     4101|       view|115244|         null|  2|          14|\n|2015-05-21 00:26:...|     4101|  addtocart|104752|         null|  4|          14|\n|2015-05-21 00:25:...|     4101|       view|376365|         null|  1|          14|\n|2015-05-21 00:11:...|     4101|       view|320620|         null|  1|          14|\n|2015-05-21 00:23:...|     4101|       view|356690|         null|  1|          14|\n|2015-05-21 00:49:...|     4101|       view|104752|         null|  4|          14|\n|2015-05-21 00:51:...|     4101|       view|230099|         null|  2|          14|\n|2015-05-21 00:28:...|     4101|  addtocart|400859|         null|  4|          14|\n|2015-05-21 00:28:...|     4101|       view|400859|         null|  4|          14|\n|2015-05-21 01:10:...|     4101|       view|204798|         null|  1|          14|\n|2015-05-21 00:32:...|     4101|transaction|170353|       5362.0|  3|          14|\n|2015-05-21 00:29:...|     4101|       view|228066|         null|  3|          14|\n|2015-05-21 00:29:...|     4101|       view|457408|         null|  1|          14|\n|2015-05-21 00:24:...|     4101|  addtocart|170353|         null|  3|          14|\n+--------------------+---------+-----------+------+-------------+---+------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548166632615_1488037824","id":"20180825-113355_1221965010","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:676"},{"title":"Prikaz seme dataset-a","text":"%spark2.pyspark\n\nevents.printSchema()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- timestamp: timestamp (nullable = true)\n |-- visitorid: integer (nullable = true)\n |-- event: string (nullable = true)\n |-- itemid: integer (nullable = true)\n |-- transactionid: double (nullable = true)\n |-- cnt: integer (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1548166632615_1488037824","id":"20180809-104443_1490227877","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:677"},{"title":"Period prikupljanja podataka","text":"%spark2.pyspark\n#logs are from 03.05.2015. to 18.09.2015.\n\nevents.agg(F.min(events.timestamp).alias('first_date'),F.max(events.timestamp).alias(\"last_date\")).show(truncate=False)","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------------+-----------------------+\n|first_date             |last_date              |\n+-----------------------+-----------------------+\n|2015-05-03 03:00:40.988|2015-09-18 02:59:11.261|\n+-----------------------+-----------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1548166632615_1488037824","id":"20180809-104621_546540298","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:678"},{"title":"Broj jedinstvenih korisnika","text":"%spark2.pyspark\n\nevents.groupBy('visitorid').count().count()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"117528\n"}]},"apps":[],"jobName":"paragraph_1548166632615_1488037824","id":"20180809-104505_1692423419","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:679"},{"title":"Broj jedinstvenih proizvoda","text":"%spark2.pyspark\n\nevents.groupBy('itemid').count().count()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"121590\n"}]},"apps":[],"jobName":"paragraph_1548166632615_1488037824","id":"20180809-104557_1812398785","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:680"},{"title":"Broj razlicitih tipova akcije","text":"%spark2.pyspark\n\nevents.groupBy('event').count().select(\"event\", \"count\").show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+------+\n|      event| count|\n+-----------+------+\n|transaction| 14703|\n|  addtocart| 41904|\n|       view|948055|\n+-----------+------+\n\n"}]},"apps":[],"jobName":"paragraph_1548166632615_1488037824","id":"20180809-103933_437682693","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:681"},{"title":"Deskriptivna statistika za events dataset","text":"%spark2.pyspark\n\nevents.describe().show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------------------+---------+------------------+-----------------+------------------+------------------+\n|summary|         visitorid|    event|            itemid|    transactionid|               cnt|      num_of_items|\n+-------+------------------+---------+------------------+-----------------+------------------+------------------+\n|  count|           1004662|  1004662|           1004662|            14703|           1004662|           1004662|\n|   mean| 694625.7505628759|     null|235560.80393405943|8832.873291165068| 3.369230646724968|   95.324074166237|\n| stddev|403726.95937740203|     null| 134233.2999062938| 5098.21346805304|10.187749156594563|293.75746567737787|\n|    min|                 0|addtocart|                 3|              3.0|                 1|                 3|\n|    max|           1407573|     view|            466864|          17671.0|               308|              2209|\n+-------+------------------+---------+------------------+-----------------+------------------+------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1548166632615_1488037824","id":"20180809-103629_459709682","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:682"},{"title":"Deljenje broja interakcija u grupe","text":"%spark2.pyspark\n\nfrom pyspark.ml.feature import Bucketizer\n\nsplits = [1, 2, 4, 10, 50, 400]\n\ndata = events.select('cnt')\n#dataFrame = spark.createDataFrame(data, [\"features\"])\n\nbucketizer = Bucketizer(splits=splits, inputCol=\"cnt\", outputCol=\"bucketedFeatures\")\n\n# Transform original data into its bucket index.\nbucketedData = bucketizer.transform(data)\n\n#print(\"Bucketizer output with %d buckets\" % (len(bucketizer.getSplits())-1))\n#bucketedData.orderBy('rating').show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632616_1486114080","id":"20180809-105406_1683970416","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:683"},{"title":"Distribucija interakcija","text":"%spark2.pyspark\n\nw1 = Window.partitionBy(\"bucketedFeatures\").orderBy('bucketedFeatures')\n\nbucketedData = bucketedData.withColumn(\"count\", F.count('cnt').over(w1)).select(\"bucketedFeatures\", \"count\")\nbd = bucketedData.select('bucketedFeatures','count').distinct().orderBy('bucketedFeatures').show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------+------+\n|bucketedFeatures| count|\n+----------------+------+\n|             0.0|524633|\n|             1.0|278964|\n|             2.0|152013|\n|             3.0| 43957|\n|             4.0|  5095|\n+----------------+------+\n\n"}]},"apps":[],"jobName":"paragraph_1548166632616_1486114080","id":"20180809-110126_1739998571","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:684"},{"title":"Racunanje broja dana izmedju log_time i poslednjeg dana prikupljanja podataka","text":"%spark2.pyspark\n\nevents = events.withColumn(\"current_date\",F.unix_timestamp(F.lit('2015-09-19'),'yyyy-MM-dd')).withColumn(\"log_date\", F.date_format(events.timestamp, \"y-M-d\"))\nevents = events.withColumn(\"current_date\", events.current_date.cast(\"timestamp\").cast(\"date\"))\nevents = events.withColumn(\"days_between\", F.datediff(events.current_date, events.log_date))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632616_1486114080","id":"20180809-113807_2115054590","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:685"},{"title":"Korisnicki definisane funckije za sabiranje kolona i izracunavanje svezine podataka","text":"%spark2.pyspark\n\ndef superSum(*cols):\n   return reduce(lambda a, b: a + b, cols)\n\ndef def_recency(x,y):\n    return (1.0/x)*y\n\nadd = F.udf(superSum)\nfun_recency = F.udf(def_recency,DoubleType())\n\ncols_for_sum_freq = [\"one\",\"two\",\"three\",\"four\",\"five\"]\ncols_for_sum_act = [\"view\",\"addtocart\",\"transaction\"]\n","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632616_1486114080","id":"20180901-183629_260215179","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:686"},{"text":"%spark2.pyspark\nevents = events.withColumn(\"cnt\", events[\"cnt\"].cast(DoubleType()))\nevents.printSchema()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- timestamp: timestamp (nullable = true)\n |-- visitorid: integer (nullable = true)\n |-- event: string (nullable = true)\n |-- itemid: integer (nullable = true)\n |-- transactionid: double (nullable = true)\n |-- cnt: double (nullable = true)\n |-- num_of_items: long (nullable = false)\n |-- current_date: date (nullable = true)\n |-- log_date: string (nullable = true)\n |-- days_between: integer (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1548166632616_1486114080","id":"20180905-165502_1022515510","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:687"},{"text":"%spark2.pyspark\nevents.show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+---------+-----------+------+-------------+---+------------+------------+---------+------------+\n|           timestamp|visitorid|      event|itemid|transactionid|cnt|num_of_items|current_date| log_date|days_between|\n+--------------------+---------+-----------+------+-------------+---+------------+------------+---------+------------+\n|2015-07-25 20:18:...|     2866|       view| 83908|         null|2.0|           3|  2015-09-19|2015-7-25|          56|\n|2015-07-25 20:30:...|     2866|       view| 83908|         null|2.0|           3|  2015-09-19|2015-7-25|          56|\n|2015-08-17 06:37:...|     2866|       view| 90950|         null|1.0|           3|  2015-09-19|2015-8-17|          33|\n|2015-09-03 05:21:...|     2866|       view|294615|         null|1.0|           3|  2015-09-19| 2015-9-3|          16|\n|2015-05-21 00:26:...|     4101|       view|104752|         null|4.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:25:...|     4101|       view|115244|         null|2.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:11:...|     4101|       view|115244|         null|2.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:26:...|     4101|  addtocart|104752|         null|4.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:25:...|     4101|       view|376365|         null|1.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:11:...|     4101|       view|320620|         null|1.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:23:...|     4101|       view|356690|         null|1.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:49:...|     4101|       view|104752|         null|4.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:51:...|     4101|       view|230099|         null|2.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:28:...|     4101|  addtocart|400859|         null|4.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:28:...|     4101|       view|400859|         null|4.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 01:10:...|     4101|       view|204798|         null|1.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:32:...|     4101|transaction|170353|       5362.0|3.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:29:...|     4101|       view|228066|         null|3.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:29:...|     4101|       view|457408|         null|1.0|          14|  2015-09-19|2015-5-21|         121|\n|2015-05-21 00:24:...|     4101|  addtocart|170353|         null|3.0|          14|  2015-09-19|2015-5-21|         121|\n+--------------------+---------+-----------+------+-------------+---+------------+------------+---------+------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548166632616_1486114080","id":"20180905-165822_874497351","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:688"},{"text":"%spark2.pyspark\ndef rate_event(r,cart,trans):\n    if r == 'view':\n        return 1.0\n    if r == 'addtocart':\n        return cart\n    if r == 'transaction':\n        return trans\n    else: \n        return 0.0\n\n    \nfun_rate_event = F.udf(rate_event,DoubleType())","dateUpdated":"2019-01-22T15:17:12+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632616_1486114080","id":"20180905-154229_167498656","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:689"},{"text":"%spark2.pyspark\nevents1 = events\nevents1 = events1.withColumn(\"rate\",fun_rate_event(events1.event,F.lit(1.5),F.lit(2.0)))\nevents1 = events1.withColumn(\"rates\",  F.when(events1.cnt > 1, F.col(\"rate\")*F.log(F.col(\"cnt\"))).otherwise(F.col(\"rate\")).cast(DoubleType()))\nevents1.printSchema()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- timestamp: timestamp (nullable = true)\n |-- visitorid: integer (nullable = true)\n |-- event: string (nullable = true)\n |-- itemid: integer (nullable = true)\n |-- transactionid: double (nullable = true)\n |-- cnt: double (nullable = true)\n |-- num_of_items: long (nullable = false)\n |-- current_date: date (nullable = true)\n |-- log_date: string (nullable = true)\n |-- days_between: integer (nullable = true)\n |-- rate: double (nullable = true)\n |-- rates: double (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1548166632617_1485729331","id":"20180905-192121_789926395","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:690"},{"text":"%spark2.pyspark\nevents1.describe().show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-----------------+---------+------------------+-----------------+-----------------+-----------------+---------+------------------+------------------+------------------+\n|summary|        visitorid|    event|            itemid|    transactionid|              cnt|     num_of_items| log_date|      days_between|              rate|             rates|\n+-------+-----------------+---------+------------------+-----------------+-----------------+-----------------+---------+------------------+------------------+------------------+\n|  count|          1004662|  1004662|           1004662|            14703|          1004662|          1004662|  1004662|           1004662|            989959|            989959|\n|   mean|694625.7505628759|     null|235560.80393405943|8832.873291165068|3.369230646724968|  95.324074166237|     null| 74.47339801843805|1.0211645128737654| 1.173153204715372|\n| stddev|403726.9593774021|     null|134233.29990629377|5098.213468053039|10.18774915659456|293.7574656773778|     null|38.510633446444274|0.1006694097967201|0.5710857334990603|\n|    min|                0|addtocart|                 3|              3.0|              1.0|                3|2015-5-10|                 1|               1.0|0.6931471805599453|\n|    max|          1407573|     view|            466864|          17671.0|            308.0|             2209| 2015-9-9|               139|               1.5| 8.048964022532777|\n+-------+-----------------+---------+------------------+-----------------+-----------------+-----------------+---------+------------------+------------------+------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1548166632617_1485729331","id":"20180905-232420_2063333957","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:691"},{"title":"Eksperiment za bazu parametara za kreiranje rejtinga","text":"%spark2.pyspark\n\nfor param_cart in [1.5,2.0,5.0,10.0,100.0]:\n    for param_trans in [2.0,2.5,5.0,10.0,100.0]:\n        tableForRating = events.withColumn(\"rate\",fun_rate_event(events.event,F.lit(param_cart),F.lit(param_trans)))\n        tableForRating = tableForRating.withColumn(\"rates\",  F.when(events.cnt > 1, F.col(\"rate\")*F.log(F.col(\"cnt\"))).otherwise(F.col(\"rate\")).cast(DoubleType()))\n        tableForRating = tableForRating.withColumn(\"rating\",fun_recency(tableForRating.days_between,tableForRating.rates))\n        ratings = tableForRating.select('visitorid', 'itemid', 'rating')\n        ratings = ratings.groupBy('visitorid', 'itemid').sum().select(\"visitorid\", \"itemid\", \"sum(rating)\")\n        ratings = ratings.withColumnRenamed(\"sum(rating)\", \"rating\")\n        ratings = ratings.withColumn(\"rnd_\", F.rand(seed=12345))\n        w = Window.partitionBy(F.col(\"visitorid\")).orderBy(F.col(\"visitorid\"),F.col(\"rnd_\"))\n        test = (ratings\n        .withColumn(\"rn_\", F.row_number().over(w))\n        .where(F.col(\"rn_\") < 4)\n        .drop(\"rn_\"))\n        test = test.withColumn(\"rank\", F.dense_rank().over(Window.partitionBy(\"visitorid\").orderBy(F.desc(\"rating\"))))\n        test = test.withColumnRenamed(\"rank\", \"rank_t\")\n        testRDD = test.select(\"visitorid\", \"itemid\", \"rank_t\").rdd\n        training = ratings.alias(\"a\").join(test.alias(\"b\"), F.col('a.rnd_') == F.col('b.rnd_') , 'left_anti')\n        print(\"For param_cart = \"+str(param_cart)+\" and param_trans = \"+str(param_trans)+\": \")\n        run_als(training,test,10,0.1,1.0)\n    \n","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"For param_cart = 1.5 and param_trans = 2.0: \nNDCG at 10 = 0.125099447356, Mean Average Precision = 0.114989298691, Precision at 10 = 0.0177392862476\nFor param_cart = 1.5 and param_trans = 2.5: \nNDCG at 10 = 0.147993634933, Mean Average Precision = 0.137416218257, Precision at 10 = 0.0216652506372\nFor param_cart = 1.5 and param_trans = 5.0: \nNDCG at 10 = 0.142570182201, Mean Average Precision = 0.133527613224, Precision at 10 = 0.0207911331932\nFor param_cart = 1.5 and param_trans = 10.0: \nNDCG at 10 = 0.130210877364, Mean Average Precision = 0.121493527652, Precision at 10 = 0.0178085843775\nFor param_cart = 1.5 and param_trans = 100.0: \nNDCG at 10 = 0.183599882059, Mean Average Precision = 0.172952285172, Precision at 10 = 0.0249413342273\nFor param_cart = 2.0 and param_trans = 2.0: \nNDCG at 10 = 0.158980910816, Mean Average Precision = 0.146932929707, Precision at 10 = 0.022982276256\nFor param_cart = 2.0 and param_trans = 2.5: \nNDCG at 10 = 0.129544006351, Mean Average Precision = 0.118307747796, Precision at 10 = 0.0190302292554\nFor param_cart = 2.0 and param_trans = 5.0: \nNDCG at 10 = 0.122510401825, Mean Average Precision = 0.11085081065, Precision at 10 = 0.0179384203481\nFor param_cart = 2.0 and param_trans = 10.0: \nNDCG at 10 = 0.140984955847, Mean Average Precision = 0.129981667464, Precision at 10 = 0.0196915351506\nFor param_cart = 2.0 and param_trans = 100.0: \nNDCG at 10 = 0.165615723562, Mean Average Precision = 0.1570998446, Precision at 10 = 0.0225524475524\nFor param_cart = 5.0 and param_trans = 2.0: \nNDCG at 10 = 0.150078320181, Mean Average Precision = 0.137183444806, Precision at 10 = 0.0220545361002\nFor param_cart = 5.0 and param_trans = 2.5: \nNDCG at 10 = 0.102690110697, Mean Average Precision = 0.0960001598338, Precision at 10 = 0.014696715416\nFor param_cart = 5.0 and param_trans = 5.0: \nNDCG at 10 = 0.127750164102, Mean Average Precision = 0.117570757776, Precision at 10 = 0.0200793836096\nFor param_cart = 5.0 and param_trans = 10.0: \nNDCG at 10 = 0.0835862775205, Mean Average Precision = 0.0781283487952, Precision at 10 = 0.0124276660237\nFor param_cart = 5.0 and param_trans = 100.0: \nNDCG at 10 = 0.194420095064, Mean Average Precision = 0.188109498579, Precision at 10 = 0.0245680718728\nFor param_cart = 10.0 and param_trans = 2.0: \nNDCG at 10 = 0.104596447077, Mean Average Precision = 0.0993977332006, Precision at 10 = 0.0151515151515\nFor param_cart = 10.0 and param_trans = 2.5: \nNDCG at 10 = 0.141056451902, Mean Average Precision = 0.130166573435, Precision at 10 = 0.0209024799552\nFor param_cart = 10.0 and param_trans = 5.0: \nNDCG at 10 = 0.137809711161, Mean Average Precision = 0.12903141906, Precision at 10 = 0.0207162921348\nFor param_cart = 10.0 and param_trans = 10.0: \nNDCG at 10 = 0.129682564738, Mean Average Precision = 0.122093286283, Precision at 10 = 0.0188925081433\nFor param_cart = 10.0 and param_trans = 100.0: \nNDCG at 10 = 0.181074819795, Mean Average Precision = 0.171083289863, Precision at 10 = 0.0236932707355\nFor param_cart = 100.0 and param_trans = 2.0: \nNDCG at 10 = 0.185368950913, Mean Average Precision = 0.176503726816, Precision at 10 = 0.023738949558\nFor param_cart = 100.0 and param_trans = 2.5: \nNDCG at 10 = 0.180531468692, Mean Average Precision = 0.174039402839, Precision at 10 = 0.0224118942731\nFor param_cart = 100.0 and param_trans = 5.0: \nNDCG at 10 = 0.164336654778, Mean Average Precision = 0.156195939179, Precision at 10 = 0.0206500956023\nFor param_cart = 100.0 and param_trans = 10.0: \nNDCG at 10 = 0.165601173841, Mean Average Precision = 0.160291826038, Precision at 10 = 0.0201657458564\nFor param_cart = 100.0 and param_trans = 100.0: \nNDCG at 10 = 0.203041408062, Mean Average Precision = 0.196211590139, Precision at 10 = 0.024421661409\n"}]},"apps":[],"jobName":"paragraph_1548166632617_1485729331","id":"20180901-183025_1334941975","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:692"},{"title":"Kreiranje rejtinga sa najboljim rezultatom eksperimenta","text":"%spark2.pyspark\n\ntableForRating = events.withColumn(\"rate\",fun_rate_event(events.event,F.lit(5.0),F.lit(100.0)))\ntableForRating = tableForRating.withColumn(\"rates\",  F.when(events.cnt > 1, F.col(\"rate\")*F.log(F.col(\"cnt\"))).otherwise(F.col(\"rate\")).cast(DoubleType()))\ntableForRating = tableForRating.withColumn(\"rating\",fun_recency(tableForRating.days_between,tableForRating.rates))\nratings = tableForRating.select('visitorid', 'itemid', 'rating')\nratings = ratings.groupBy('visitorid', 'itemid').sum().select(\"visitorid\", \"itemid\", \"sum(rating)\")\nratings = ratings.withColumnRenamed(\"sum(rating)\", \"rating\")\nratings = ratings.withColumn(\"rnd_\", F.rand(seed=12345))\nw = Window.partitionBy(F.col(\"visitorid\")).orderBy(F.col(\"visitorid\"),F.col(\"rnd_\"))\ntest = (ratings\n.withColumn(\"rn_\", F.row_number().over(w))\n.where(F.col(\"rn_\") < 4)\n.drop(\"rn_\"))\ntest = test.withColumn(\"rank\", F.dense_rank().over(Window.partitionBy(\"visitorid\").orderBy(F.desc(\"rating\"))))\ntest = test.withColumnRenamed(\"rank\", \"rank_t\")\ntestRDD = test.select(\"visitorid\", \"itemid\", \"rank_t\").rdd\ntraining = ratings.alias(\"a\").join(test.alias(\"b\"), F.col('a.rnd_') == F.col('b.rnd_') , 'left_anti')","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632617_1485729331","id":"20180903-185553_1454993539","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:693"},{"title":"OBJASNJENJE EKSPERIMENTA KORAK PO KORAK","text":"%spark2.pyspark\n","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548166632617_1485729331","id":"20180904-213815_508344017","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:694"},{"title":"Rejtinzi za tip akcije","text":"%spark2.pyspark\n\ntableForRating = events.withColumn('view', F.when(events['event'] == 'view', 1).otherwise(0))\ntableForRating = tableForRating.withColumn('addtocart', F.when(tableForRating['event'] == 'addtocart', 3).otherwise(0))\ntableForRating = tableForRating.withColumn('transaction', F.when(tableForRating['event'] == 'transaction', 5).otherwise(0))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632617_1485729331","id":"20180825-113618_923680730","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:695"},{"title":"Rejtinzi za broj akcija","text":"%spark2.pyspark\n\ntableForRating = tableForRating.withColumn('one', F.when(tableForRating['cnt'] < 2, 1).otherwise(0))\ntableForRating = tableForRating.withColumn('two',   F.when(tableForRating['cnt'] ==2, 2).otherwise(0))\ntableForRating = tableForRating.withColumn('three', F.when((tableForRating['cnt'] >2)& (tableForRating['cnt'] < 11), 3).otherwise(0))\ntableForRating = tableForRating.withColumn('four', F.when((tableForRating['cnt'] >10)& (tableForRating['cnt'] < 101), 4).otherwise(0))\ntableForRating = tableForRating.withColumn('five', F.when(tableForRating['cnt']>100, 5).otherwise(0))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632617_1485729331","id":"20180825-120443_1641872362","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:696"},{"title":"Prikaz tabele rejtinga","text":"%spark2.pyspark\n\ntableForRating.show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+---------+-----------+------+-------------+---+------------+------------+---------+------------+----+---------+-----------+---+---+-----+----+----+----+---+------+\n|           timestamp|visitorid|      event|itemid|transactionid|cnt|num_of_items|current_date| log_date|days_between|view|addtocart|transaction|one|two|three|four|five|freq|act|rating|\n+--------------------+---------+-----------+------+-------------+---+------------+------------+---------+------------+----+---------+-----------+---+---+-----+----+----+----+---+------+\n|2015-08-17 06:37:...|     2866|       view| 90950|         null|  1|           3|  2015-09-19|2015-8-17|          33|   1|        0|          0|  1|  0|    0|   0|   0|   1|  1|   1.0|\n|2015-09-03 05:21:...|     2866|       view|294615|         null|  1|           3|  2015-09-19| 2015-9-3|          16|   1|        0|          0|  1|  0|    0|   0|   0|   1|  1|   1.0|\n|2015-07-25 20:18:...|     2866|       view| 83908|         null|  2|           3|  2015-09-19|2015-7-25|          56|   1|        0|          0|  0|  2|    0|   0|   0|   2|  1|   1.5|\n|2015-07-25 20:30:...|     2866|       view| 83908|         null|  2|           3|  2015-09-19|2015-7-25|          56|   1|        0|          0|  0|  2|    0|   0|   0|   2|  1|   1.5|\n|2015-05-21 00:26:...|     4101|       view|104752|         null|  4|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  0|  0|    3|   0|   0|   3|  1|   2.0|\n|2015-05-21 00:25:...|     4101|       view|115244|         null|  2|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  0|  2|    0|   0|   0|   2|  1|   1.5|\n|2015-05-21 00:11:...|     4101|       view|115244|         null|  2|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  0|  2|    0|   0|   0|   2|  1|   1.5|\n|2015-05-21 00:26:...|     4101|  addtocart|104752|         null|  4|          14|  2015-09-19|2015-5-21|         121|   0|        3|          0|  0|  0|    3|   0|   0|   3|  3|   3.0|\n|2015-05-21 00:25:...|     4101|       view|376365|         null|  1|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  1|  0|    0|   0|   0|   1|  1|   1.0|\n|2015-05-21 00:11:...|     4101|       view|320620|         null|  1|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  1|  0|    0|   0|   0|   1|  1|   1.0|\n|2015-05-21 00:23:...|     4101|       view|356690|         null|  1|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  1|  0|    0|   0|   0|   1|  1|   1.0|\n|2015-05-21 00:49:...|     4101|       view|104752|         null|  4|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  0|  0|    3|   0|   0|   3|  1|   2.0|\n|2015-05-21 00:51:...|     4101|       view|230099|         null|  2|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  0|  2|    0|   0|   0|   2|  1|   1.5|\n|2015-05-21 00:28:...|     4101|  addtocart|400859|         null|  4|          14|  2015-09-19|2015-5-21|         121|   0|        3|          0|  0|  0|    3|   0|   0|   3|  3|   3.0|\n|2015-05-21 00:28:...|     4101|       view|400859|         null|  4|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  0|  0|    3|   0|   0|   3|  1|   2.0|\n|2015-05-21 01:10:...|     4101|       view|204798|         null|  1|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  1|  0|    0|   0|   0|   1|  1|   1.0|\n|2015-05-21 00:32:...|     4101|transaction|170353|       5362.0|  3|          14|  2015-09-19|2015-5-21|         121|   0|        0|          5|  0|  0|    3|   0|   0|   3|  5|   4.0|\n|2015-05-21 00:29:...|     4101|       view|228066|         null|  3|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  0|  0|    3|   0|   0|   3|  1|   2.0|\n|2015-05-21 00:29:...|     4101|       view|457408|         null|  1|          14|  2015-09-19|2015-5-21|         121|   1|        0|          0|  1|  0|    0|   0|   0|   1|  1|   1.0|\n|2015-05-21 00:24:...|     4101|  addtocart|170353|         null|  3|          14|  2015-09-19|2015-5-21|         121|   0|        3|          0|  0|  0|    3|   0|   0|   3|  3|   3.0|\n+--------------------+---------+-----------+------+-------------+---+------------+------------+---------+------------+----+---------+-----------+---+---+-----+----+----+----+---+------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548166632618_1486883578","id":"20180825-121624_995383943","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:697"},{"title":"Izbor kolona za tabelu rejtinga","text":"%spark2.pyspark\n\nratings = tableForRating.select('visitorid', 'itemid', 'recency')","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632618_1486883578","id":"20180825-121808_92308893","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:698"},{"title":"Racunanje prosecne ocene korisnika za proizvode","text":"%spark2.pyspark\nratings = ratings.groupBy('visitorid', 'itemid').mean().select(\"visitorid\", \"itemid\", \"avg(recency)\")","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632618_1486883578","id":"20180825-122525_1968455342","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:699"},{"title":"Deskriptivna statistika za tabelu rejtinga","text":"%spark2.pyspark\nratings.describe().show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------------------+------------------+--------------------+\n|summary|         visitorid|            itemid|        avg(recency)|\n+-------+------------------+------------------+--------------------+\n|  count|            680763|            680763|              680763|\n|   mean| 695538.2954552466|235094.16535710666|0.034075832295908756|\n| stddev|403900.21671124874| 134096.3626455295| 0.06696437399807272|\n|    min|                 0|                 3|0.007194244604316547|\n|    max|           1407573|            466864|                 3.0|\n+-------+------------------+------------------+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1548166632618_1486883578","id":"20180825-123929_1657613940","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:700"},{"title":"Preimenovanje kolone","text":"%spark2.pyspark\nratings = ratings.withColumnRenamed(\"avg(recency)\", \"rating\")","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632618_1486883578","id":"20180825-181630_982449088","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:701"},{"title":"Zapisivanje tabele rejtinga","text":"%spark2.pyspark\n\nratings.write.mode('overwrite').option(\"header\", \"true\").csv('ratings_events.csv')","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632618_1486883578","id":"20180825-123938_2047263546","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:702"},{"title":"OBJASNJENJE ALS-A","text":"%spark2.pyspark\n","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548166632619_1486498829","id":"20180825-183552_1044673568","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:703"},{"title":"Nasumicno deljenje rejtinga na train i test set","text":"%spark2.pyspark\n#(training, test) = ratings.randomSplit([0.8,0.2])","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632619_1486498829","id":"20180825-182401_15702588","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:704"},{"title":"ALS sa podrazumevanim vrednostima parametara","text":"%spark2.pyspark\n\nals = ALS(nonnegative=True, coldStartStrategy=\"drop\",userCol=\"visitorid\", itemCol=\"itemid\", ratingCol=\"rating\", seed = 12345, implicitPrefs=True)","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632619_1486498829","id":"20180825-124157_1020039609","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:705"},{"title":"Fitovanje modela na trening setu","text":"%spark2.pyspark\n\nmodel = als.fit(training)","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632619_1486498829","id":"20180825-181905_1253562479","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:706"},{"title":"Generisanje predikcija i racunanje metrike RMSE","text":"%spark2.pyspark\n\npredictions = model.transform(test)\nevaluator = RegressionEvaluator(metricName=\"rmse\", labelCol=\"rating\", predictionCol=\"prediction\")\nrmse = evaluator.evaluate(predictions)\n\nprint(\"Root-mean-square error = \" +str(rmse))\n","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Root-mean-square error = 0.0828498487284\n"}]},"apps":[],"jobName":"paragraph_1548166632619_1486498829","id":"20180825-182455_432206468","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:707"},{"title":"Kastovanje kolone predikcija u double","text":"%spark2.pyspark\n\npredictions = predictions.withColumn(\"prediction\", predictions.prediction.cast(\"double\"))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632619_1486498829","id":"20180825-191056_673229764","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:708"},{"title":"Izracunavanje tacnosti","text":"%spark2.pyspark\n\nevaluator = MulticlassClassificationEvaluator(metricName=\"accuracy\", labelCol=\"rating\", predictionCol=\"prediction\")\naccuracy = evaluator.evaluate(predictions)\n\nprint(\"Accuracy = \" +str(accuracy))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Accuracy = 0.0\n"}]},"apps":[],"jobName":"paragraph_1548166632619_1486498829","id":"20180825-190542_1704002619","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:709"},{"title":"Izracunavanje otezane preciznosti","text":"%spark2.pyspark\n\nevaluator = MulticlassClassificationEvaluator(metricName=\"weightedPrecision\", labelCol=\"rating\", predictionCol=\"prediction\")\nwp = evaluator.evaluate(predictions)\n\nprint(\"WeightedPrecision = \" +str(wp))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"WeightedPrecision = 0.0\n"}]},"apps":[],"jobName":"paragraph_1548166632620_1484575084","id":"20180825-191413_2052285656","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:710"},{"title":"Generisanje top 10 preporuka za svakog korisnika","text":"%spark2.pyspark\n\nprodRecs = model.recommendForAllUsers(10)","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632620_1484575084","id":"20180825-181930_743660991","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:711"},{"title":"Prikaz preporuka","text":"%spark2.pyspark\n\nprodRecs.show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+--------------------+\n|visitorid|     recommendations|\n+---------+--------------------+\n|      496|[[72462, 0.014689...|\n|     1238|[[72462, 0.030942...|\n|     1580|[[204778, 4.83267...|\n|     1645|[[72462, 0.011401...|\n|     2659|[[264420, 0.00693...|\n|     2866|[[185582, 9.83409...|\n|     3175|[[72462, 6.114003...|\n|     3918|[[72462, 1.450903...|\n|     3997|[[72462, 0.002187...|\n|     4101|[[122435, 1.18533...|\n|     4935|[[72462, 5.894229...|\n|     5803|[[72462, 0.030433...|\n|     7340|[[72462, 1.231164...|\n|     8592|[[72462, 3.007918...|\n|     8638|[[264420, 2.35829...|\n|     9852|[[105788, 8.15025...|\n|    10817|[[359329, 1.20212...|\n|    11033|[[204778, 0.03175...|\n|    11748|[[72462, 0.010937...|\n|    11858|[[72462, 1.426473...|\n+---------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548166632620_1484575084","id":"20180825-182059_1222774136","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:712"},{"text":"%spark2.pyspark\nprodRecs.printSchema()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- visitorid: integer (nullable = false)\n |-- recommendations: array (nullable = true)\n |    |-- element: struct (containsNull = true)\n |    |    |-- itemid: integer (nullable = true)\n |    |    |-- rating: float (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1548166632620_1484575084","id":"20180902-121350_1998602809","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:713"},{"title":"Razdvajanje kolone recommendations na kolone itemid i rating","text":"%spark2.pyspark\n\nfrom pyspark.sql.functions import col, explode\nprodRecs = prodRecs.withColumn(\"recommendations\", explode(\"recommendations\")).select(\"*\", col(\"recommendations\")[\"itemid\"].alias(\"itemid\"),col(\"recommendations\")[\"rating\"].alias(\"rating\"))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632620_1484575084","id":"20180825-182106_650756030","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:714"},{"title":"Prikaz preporuka","text":"%spark2.pyspark\nprodRecs.show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+--------------------+------+-------------+\n|visitorid|     recommendations|itemid|       rating|\n+---------+--------------------+------+-------------+\n|      496|[191049, 2.482729...|191049| 2.4827296E-4|\n|      496|[119736, 2.364907...|119736| 2.3649071E-4|\n|      496|[338395, 1.476958...|338395| 1.4769587E-4|\n|      496|[174724, 1.344452...|174724|  1.344452E-4|\n|      496|[456056, 1.315834...|456056| 1.3158347E-4|\n|      496|[439963, 1.113103...|439963| 1.1131031E-4|\n|      496|[146613, 1.035898...|146613|1.03589875E-4|\n|      496|[150882, 9.821344...|150882| 9.8213444E-5|\n|      496|[329133, 9.222799...|329133| 9.2227994E-5|\n|      496|[369158, 9.164931...|369158|  9.164931E-5|\n|     1238|[191049, 0.008811...|191049|  0.008811845|\n|     1238|[119736, 0.008393...|119736|  0.008393186|\n|     1238|[338395, 0.005241...|338395|  0.005241942|\n|     1238|[174724, 0.004771...|174724|  0.004771574|\n|     1238|[456056, 0.004670...|456056| 0.0046700705|\n|     1238|[439963, 0.003950...|439963|  0.003950597|\n|     1238|[146613, 0.003676...|146613| 0.0036766066|\n|     1238|[150882, 0.00348571]|150882|   0.00348571|\n|     1238|[329133, 0.003273...|329133| 0.0032733502|\n|     1238|[369158, 0.003252...|369158| 0.0032526683|\n+---------+--------------------+------+-------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548166632620_1484575084","id":"20180826-105430_415322727","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:715"},{"title":"Izbor neophodnih kolona","text":"%spark2.pyspark\nprodRecs = prodRecs.select(\"visitorid\", \"itemid\", \"rating\")","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632621_1484190335","id":"20180826-113827_2030878750","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:716"},{"title":"Dodavanje kolone rank","text":"%spark2.pyspark\n\nprodRecs = prodRecs.withColumn(\"rank\", F.dense_rank().over(Window.partitionBy(\"visitorid\").orderBy(F.desc(\"rating\"))))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632621_1484190335","id":"20180826-105440_5899016","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:717"},{"title":"Prikaz preporuka sa rankom","text":"%spark2.pyspark\nprodRecs.show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+------+------------+----+\n|visitorid|itemid|      rating|rank|\n+---------+------+------------+----+\n|     2866|169680|         0.0|   1|\n|     2866|169720|         0.0|   1|\n|     2866|169810|         0.0|   1|\n|     2866|169860|         0.0|   1|\n|     2866|169920|         0.0|   1|\n|     2866|169940|         0.0|   1|\n|     2866|169980|         0.0|   1|\n|     2866|170100|         0.0|   1|\n|     2866|170150|         0.0|   1|\n|     2866|170270|         0.0|   1|\n|     4101|338395|0.0017050267|   1|\n|     4101|456056|0.0016518546|   2|\n|     4101|146613|0.0015921709|   3|\n|     4101| 25762| 0.001473557|   4|\n|     4101|439963|0.0014666638|   5|\n|     4101| 62275|0.0014550245|   6|\n|     4101|400442|0.0014122836|   7|\n|     4101| 89323|0.0013680652|   8|\n|     4101|119736|0.0013515499|   9|\n|     4101|186702|0.0013347843|  10|\n+---------+------+------------+----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548166632621_1484190335","id":"20180826-113853_1948709731","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:718"},{"title":"Dodavanje rank kolone i u test setu","text":"%spark2.pyspark\n\ntest = test.withColumn(\"rank\", F.dense_rank().over(Window.partitionBy(\"visitorid\").orderBy(F.desc(\"rating\"))))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632621_1484190335","id":"20180826-113901_996763797","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:719"},{"title":"Prikaz rejtinga u test setu","text":"%spark2.pyspark\ntest.orderBy(\"visitorid\").show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+------+--------------------+--------------------+----+\n|visitorid|itemid|              rating|                rnd_|rank|\n+---------+------+--------------------+--------------------+----+\n|        0|357564|               0.125| 0.18906904157205107|   1|\n|        2|342816| 0.03488372093023256| 0.18098484177444552|   1|\n|        6| 65273|                 0.1| 0.23340614598335307|   1|\n|        7|226353|0.007936507936507936| 0.03029216665777701|   1|\n|       51|358388| 0.07142857142857142|  0.1153640093920626|   1|\n|       54|388096|               0.375|0.028555085268149427|   1|\n|       60|257070|0.011111111111111112| 0.08794860222775214|   1|\n|       64|160984|0.016433189655172414| 0.19591378019892836|   1|\n|       65|168656|0.011235955056179775| 0.12082103371963959|   1|\n|       74| 45410|0.009174311926605505|0.014812049356964785|   1|\n|       89|277742|0.013888888888888888|  0.2996873175182202|   1|\n|       97|291964| 0.02112676056338028| 0.12392970583508378|   1|\n|      155|151670|                0.04| 0.11705226818982017|   1|\n|      162|390093|0.009345794392523364| 0.22192107158470709|   1|\n|      169|326449|  0.0196078431372549| 0.07991932000525104|   1|\n|      172| 55710|0.014925373134328358| 0.03956357856319381|   1|\n|      224|443407|  0.0425531914893617|  0.6953881720809383|   1|\n|      258|449865| 0.02857142857142857| 0.06302824101263105|   1|\n|      266|212515| 0.01282051282051282|  0.3336567340011335|   1|\n|      278|405060|0.007874015748031496| 0.06299362509474671|   1|\n+---------+------+--------------------+--------------------+----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548166632621_1484190335","id":"20180826-123441_880344468","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:720"},{"title":"Deskriptivna statistika za test set","text":"%spark2.pyspark\ntest.describe().show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-----------------+------------------+--------------------+--------------------+------+\n|summary|        visitorid|            itemid|              rating|                rnd_|  rank|\n+-------+-----------------+------------------+--------------------+--------------------+------+\n|  count|           117528|            117528|              117528|              117528|117528|\n|   mean|702523.8428374515| 234664.3031362739|  0.0337215151478608| 0.19668858942761963|   1.0|\n| stddev|405938.8711175718|134330.87376594587|  0.0643532558822203| 0.17522264982430835|   0.0|\n|    min|                0|                 6|0.007194244604316547|9.431332887999133E-7|     1|\n|    max|          1407573|            466864|  2.3333333333333335|  0.9888662071224894|     1|\n+-------+-----------------+------------------+--------------------+--------------------+------+\n\n"}]},"apps":[],"jobName":"paragraph_1548166632621_1484190335","id":"20180826-180948_421018820","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:721"},{"title":"Preimenovanje kolona","text":"%spark2.pyspark\nprodRecs = prodRecs.withColumnRenamed(\"rank\", \"rank_p\")\ntest = test.withColumnRenamed(\"rank\", \"rank_t\")","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632621_1484190335","id":"20180826-124808_164319544","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:722"},{"title":"Kreiranje RDD-ja od predikcija i test seta","text":"%spark2.pyspark\nrecsRDD = prodRecs.select(\"visitorid\", \"itemid\", \"rank_p\").rdd\ntestRDD = test.select(\"visitorid\", \"itemid\", \"rank_t\").rdd","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632622_1485344582","id":"20180826-123632_1695609254","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:723"},{"title":"Spajanje kolona visitorid i itemid, pa join predikcija i test seta nad tim kolonama","text":"%spark2.pyspark\n\npredictions = recsRDD.map(lambda r: ((r.visitorid, r.itemid), r.rank_p))\ntests = testRDD.map(lambda r: ((r.visitorid, r.itemid), r.rank_t))\nscoreAndLabels = predictions.join(tests)\n\n","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632622_1485344582","id":"20180826-123922_2070485595","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:724"},{"title":"Vracanje u dataframe scoreAndLabels","text":"%spark2.pyspark\ndf = scoreAndLabels.toDF()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632622_1485344582","id":"20180826-144751_657679920","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:725"},{"title":"Prikaz scoreAndLabels","text":"%spark2.pyspark\ndf.show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+-------+\n|               _1|     _2|\n+-----------------+-------+\n| [427113, 213213]| [6, 1]|\n| [226934, 159616]| [5, 1]|\n| [307046, 236676]| [4, 1]|\n| [875913, 162432]| [1, 1]|\n|[1055369, 376401]|[13, 1]|\n|[1060972, 397569]| [2, 1]|\n|  [30412, 397852]|[15, 1]|\n| [1129473, 97506]| [2, 1]|\n| [535477, 263508]|[16, 1]|\n+-----------------+-------+\n\n"}]},"apps":[],"jobName":"paragraph_1548166632622_1485344582","id":"20180826-153046_1814430969","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:726"},{"title":"Kreiranje kolona visitorid, itemid, rank_p and rank_t","text":"%spark2.pyspark\n\ndf_ranks = df.select(df[\"_1\"].getItem(\"_1\").alias(\"visitorid\"), \n        df[\"_1\"].getItem(\"_2\").alias(\"itemid\"), \n        df[\"_2\"].getItem(\"_1\").alias(\"rank_p\"),\n        df[\"_2\"].getItem(\"_2\").alias(\"rank_t\"))\n","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632622_1485344582","id":"20180826-144843_930593423","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:727"},{"title":"Prikaz ranks dataframe-a","text":"%spark2.pyspark\ndf_ranks.orderBy('visitorid').show(50)","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+------+------+------+\n|visitorid|itemid|rank_p|rank_t|\n+---------+------+------+------+\n|      306|303828|     4|     1|\n|     1634|438322|    10|     1|\n|     1694|455183|     3|     1|\n|     2440| 58638|     8|     1|\n|     2685|118551|     7|     1|\n|     2856|455183|     3|     1|\n|     3095|292444|     7|     1|\n|     4622|190000|     3|     1|\n|     5623|355994|     2|     1|\n|     5673|234255|     1|     1|\n|     5894| 35608|    10|     1|\n|     5980|320130|     6|     1|\n|     6952|461686|     1|     1|\n|     7014|219512|     1|     1|\n|     7051|367664|     4|     1|\n|     7294|118914|     5|     1|\n|     7364|303828|     4|     1|\n|     7981| 91105|     6|     1|\n|     8248|384302|     2|     1|\n|     9052|118551|     7|     1|\n|     9661| 62275|     5|     1|\n|     9708|355994|     2|     1|\n|    10023|455183|     3|     1|\n|    10024|382751|     9|     1|\n|    11541|118914|     5|     1|\n|    11589|460188|     8|     1|\n|    11618|414410|     7|     1|\n|    11630|206880|     7|     1|\n|    12703| 38965|     4|     1|\n|    12901|399031|     1|     1|\n|    13729|424515|     3|     1|\n|    14276|309778|     2|     1|\n|    16288|320130|     6|     1|\n|    16862|355994|     2|     1|\n|    17182|360487|     3|     1|\n|    17276|219512|     1|     1|\n|    17640|190000|     3|     1|\n|    17947| 38965|     4|     1|\n|    18304|241555|     2|     1|\n|    18930|347414|     8|     1|\n|    19148|254418|     2|     1|\n|    19229|190000|     3|     1|\n|    19528|350103|     5|     1|\n|    19780|161623|    10|     1|\n|    19942|337327|    10|     1|\n|    20593| 64951|    10|     1|\n|    21104|276494|     9|     1|\n|    21329|375822|     5|     1|\n|    22217|234255|     1|     1|\n|    22659|266900|     3|     1|\n+---------+------+------+------+\nonly showing top 50 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548166632622_1485344582","id":"20180826-154336_325793013","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:728"},{"title":"Grupisanje rangova po korisnicima","text":"%spark2.pyspark\nfrom pyspark.sql.functions import collect_list\ngrouped_ranks = df_ranks.groupby('visitorid').agg(collect_list('rank_p').alias(\"rank_p\"),collect_list('rank_t').alias(\"rank_t\"))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632623_1484959833","id":"20180826-181317_1049338990","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:729"},{"title":"Prikaz grupisanih rangova","text":"%spark2.pyspark\ngrouped_ranks.orderBy(\"visitorid\").show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+------+------+\n|visitorid|rank_p|rank_t|\n+---------+------+------+\n|    30412|  [15]|   [1]|\n|   226934|   [5]|   [1]|\n|   307046|   [4]|   [1]|\n|   427113|   [6]|   [1]|\n|   535477|  [16]|   [1]|\n|   875913|   [1]|   [1]|\n|  1055369|  [13]|   [1]|\n|  1060972|   [2]|   [1]|\n|  1129473|   [2]|   [1]|\n+---------+------+------+\n\n"}]},"apps":[],"jobName":"paragraph_1548166632623_1484959833","id":"20180826-181436_246388475","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:730"},{"title":"Spajanje predikcija i stvarnih rangova","text":"%spark2.pyspark\ngrouped_ranks = grouped_ranks.withColumn(\"ranks\",F.array(col(\"rank_p\"), col(\"rank_t\")))","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632623_1484959833","id":"20180826-182429_1038752258","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:731"},{"title":"Prikaz grupisanih rangova","text":"%spark2.pyspark\ngrouped_ranks.orderBy(\"visitorid\").show()","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+------+------+-----------+\n|visitorid|rank_p|rank_t|      ranks|\n+---------+------+------+-----------+\n|      306|   [4]|   [1]| [[4], [1]]|\n|     1634|  [10]|   [1]|[[10], [1]]|\n|     1694|   [3]|   [1]| [[3], [1]]|\n|     2440|   [8]|   [1]| [[8], [1]]|\n|     2685|   [7]|   [1]| [[7], [1]]|\n|     2856|   [3]|   [1]| [[3], [1]]|\n|     3095|   [7]|   [1]| [[7], [1]]|\n|     4622|   [3]|   [1]| [[3], [1]]|\n|     5623|   [2]|   [1]| [[2], [1]]|\n|     5673|   [1]|   [1]| [[1], [1]]|\n|     5894|  [10]|   [1]|[[10], [1]]|\n|     5980|   [6]|   [1]| [[6], [1]]|\n|     6952|   [1]|   [1]| [[1], [1]]|\n|     7014|   [1]|   [1]| [[1], [1]]|\n|     7051|   [4]|   [1]| [[4], [1]]|\n|     7294|   [5]|   [1]| [[5], [1]]|\n|     7364|   [4]|   [1]| [[4], [1]]|\n|     7981|   [6]|   [1]| [[6], [1]]|\n|     8248|   [2]|   [1]| [[2], [1]]|\n|     9052|   [7]|   [1]| [[7], [1]]|\n+---------+------+------+-----------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548166632623_1484959833","id":"20180826-182618_1746303987","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:732"},{"title":"Izbor samo poslednje kolone sa rangovima","text":"%spark2.pyspark\nranks = grouped_ranks.select(\"ranks\")","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632623_1484959833","id":"20180826-183205_1653325196","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:733"},{"title":"Kreiranje liste od kolone rangova","text":"%spark2.pyspark\nrank = ranks.select(\"ranks\").rdd.flatMap(lambda x: x)","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548166632623_1484959833","id":"20180826-185730_194600623","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:734"},{"title":"Metrika NDCG at 10","text":"%spark2.pyspark\n\nmetrics = RankingMetrics(rank)\nmetrics.ndcgAt(1)","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.1111111111111111\n"}]},"apps":[],"jobName":"paragraph_1548166632623_1484959833","id":"20180826-185919_730832544","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:735"},{"title":"Metrika Mean Average Precision","text":"%spark2.pyspark\nmetrics = RankingMetrics(rank)\nmetrics.meanAveragePrecision","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.1111111111111111\n"}]},"apps":[],"jobName":"paragraph_1548166632624_1495348053","id":"20180826-190233_744152146","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:736"},{"title":"Metrika Precision at 10 ","text":"%spark2.pyspark\nmetrics.precisionAt(1)","dateUpdated":"2019-01-22T15:17:12+0100","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.1111111111111111\n"}]},"apps":[],"jobName":"paragraph_1548166632624_1495348053","id":"20180826-190238_586790859","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:737"},{"text":"%spark2.pyspark\n","dateUpdated":"2019-01-22T15:17:12+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548166632624_1495348053","id":"20180826-123501_1804954798","dateCreated":"2019-01-22T15:17:12+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:738"}],"name":"/Marija/events","id":"2E3MB9DW4","angularObjects":{"2CHS8UYQQ:shared_process":[],"2DJR44AWX:shared_process":[],"2DS5MUA22:shared_process":[],"2CK8A9MEG:shared_process":[],"2CKX8WPU1:shared_process":[],"2C4U48MY3_spark2::2E3MB9DW4":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":true,"looknfeel":"default","personalizedMode":"false"},"info":{}}